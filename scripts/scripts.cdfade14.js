(function(){"use strict";angular.module("seminaire2014App",["seminaire2014App.directives","etyssa","ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","leaflet-directive","ui.router","cgNotify"]).run(["$rootScope","api",function(a,b){return b.init({email:"olivoelement",password:"coucou"}),a.$on("$viewContentLoaded",function(){return $(document).foundation()})}])}).call(this),function(){"use strict";angular.module("etyssa",["etyssa.config"]).factory("Services",["$resource","GENERAL_CONFIG",function(a,b){return a(""+b.API_HOST+"/rest/services/:service_name/?token=:token",{token:b.ETYSSA_API_TOKEN},{query:{method:"GET",isArray:!0,transformResponse:function(a){return angular.fromJson(a).services}}})}]).factory("Categories",["$resource","GENERAL_CONFIG",function(a,b){return a(""+b.API_HOST+"/rest/categories?token=:token",{token:b.ETYSSA_API_TOKEN},{})}]).factory("Search",["$resource","GENERAL_CONFIG",function(a,b){return a(""+b.API_HOST+"/rest/search?cat=:cat&token=:token",{token:b.ETYSSA_API_TOKEN},{})}]).factory("Entries",["$resource","GENERAL_CONFIG",function(a,b){return a(""+b.API_HOST+"/rest/entries/:entry_id?token=:token",{token:b.ETYSSA_API_TOKEN},{})}]).factory("Users",["$resource","GENERAL_CONFIG",function(a,b){return a(""+b.API_HOST+"/rest/users/:user_id?token=:token",{token:b.ETYSSA_API_TOKEN},{})}]).factory("Profile",["$resource","GENERAL_CONFIG",function(a,b){return a(""+b.API_HOST+"/rest/me/?token=:token",{token:b.ETYSSA_API_TOKEN},{})}]).factory("Message",["$resource","GENERAL_CONFIG",function(a,b){return a(""+b.API_HOST+"/rest/messages/?token=:token",{token:b.ETYSSA_API_TOKEN},{})}]),angular.module("etyssa").factory("api",["$http","$cookies",function(a){return{init:function(b){return a.defaults.headers.common.email=b.email,a.defaults.headers.common.password=CryptoJS.SHA1(b.password)}}}]),angular.module("etyssa").factory("httpInterceptor",["$q","$window","$location",function(a){return function(b){var c,d;return d=function(a){return a},c=function(b){return console.warn("httpInterceptor",b.status,b.status),a.reject(b)},b.then(d)}}])}.call(this),function(){!function(){var a,b;return a={GENERAL_CONFIG:{ETYSSA_API_TOKEN:"a5ec51cb-8590-4a50-b797-9fbbaf50854a",API_HOST:"http://api.scriptysse.fr"}},b=angular.module("etyssa.config",[]),angular.forEach(a,function(a,c){return b.constant(c,a)})}()}.call(this),function(){"use strict";angular.module("seminaire2014App").controller("SearchCtrl",["$scope","Services","Categories","Entries","Users","leafletData",function(a,b,c,d,e){var f;return f=this,a.search_params={},a.visited_results={},a.favorited_results={},a.favorite_mode=!1,a.contact_form={show:!1},f.search=function(){return function(b){var c;return b=b||{},null!=a.search_params.selected_category&&(c=a.search_params.selected_category.alias),f.results=d.query({cat:c,to_address:"issy",limit:b.limit||200,map_optimized:!0},function(b){return a.results=angular.copy(b)})}}(this),a.service=b.get({service_name:"issy"}),a.categories=c.query(),a.$watch("favorite_mode",function(b){var c;return b?(c=Object.keys(a.favorited_results).map(function(a){return parseInt(a)}),a.results=a.results.filter(function(a){return c.indexOf(a.id)>-1})):a.results=angular.copy(f.results)}),a.getCategorie=function(b){return _.find(a.categories,function(a){return a.alias===b})},a.toggleFavorite=function(b){return null!=a.favorited_results[b.id]?delete a.favorited_results[b.id]:a.favorited_results[b.id]=!0},a.isMotivationSelected=function(b){return _.some(a.search_params.motivations_selected,function(a){return a.alias===b.alias})},a.toggleMotivation=function(b){var c,d,e,f,g;for(g=a.search_params.motivations_selected,c=e=0,f=g.length;f>e;c=++e)if(d=g[c],d.alias===b.alias)return a.search_params.motivations_selected.splice(c,1);return a.search_params.motivations_selected.push(b)},a.toggleAllFilter=function(){return a.search_params.motivations_selected=a.search_params.motivations_selected.length===a.search_params.selected_category.motivations.length?[]:angular.copy(a.search_params.selected_category.motivations)},a.focusOnEntry=function(){return function(b){return a.visited_results[b.id]=!0,a.contact_form.show=!1,null!=b.creation_date?a.entry_selected=b:d.get({entry_id:b.id},function(b){return a.entry_selected=b}),a.related_user=e.get({user_id:b.creator_nickname})}}(this),a.$watch("search_params.selected_category",function(){var b;return b={},null!=a.search_params.selected_category?a.search_params.motivations_selected=angular.copy(a.search_params.selected_category.motivations):(b.limit=10,a.search_params.motivations_selected=void 0),a.entry_selected=void 0,f.search(b)}),a.hasNextEntry=function(){var b,c,d,e,f;if(null!=a.entry_selected)for(f=a.results,c=d=0,e=f.length;e>d;c=++d)if(b=f[c],null!=b&&b.id===a.entry_selected.id)return a.results.length>c+1},a.nextEntry=function(){var b,c,d,e,f;for(f=a.results,c=d=0,e=f.length;e>d;c=++d)if(b=f[c],null!=b&&b.id===a.entry_selected.id)return a.focusOnEntry(a.results[c+1])},a.hasPreviousEntry=function(){var b,c,d,e,f;if(null!=a.entry_selected)for(f=a.results,c=d=0,e=f.length;e>d;c=++d)if(b=f[c],null!=b&&b.id===a.entry_selected.id)return c>0},a.previousEntry=function(){var b,c,d,e,f;for(f=a.results,c=d=0,e=f.length;e>d;c=++d)if(b=f[c],null!=b&&b.id===a.entry_selected.id)return a.focusOnEntry(a.results[c-1])},a.$watch("search_params.motivations_selected",function(b){var c;return null!=b&&null!=f.results?(c=angular.copy(f.results),c=c.filter(function(b){var c,d,e,f,g,h,i,j;if(null!=b.motivations)for(e=angular.copy(a.search_params.motivations_selected),f=0,h=e.length;h>f;f++)for(d=e[f],j=b.motivations,g=0,i=j.length;i>g;g++)if(c=j[g],parseInt(d.id)===c.id)return!0}),a.results=c):void 0},!0),angular.extend(a,{tiles:{url:"https://stamen-tiles-{s}.a.ssl.fastly.net/toner/{z}/{x}/{y}.png"},defaults:{scrollWheelZoom:!1},markers:{}}),a.$watch("results",function(b){var c,d,e,f;if(c={},null!=b){for(e=0,f=b.length;f>e;e++)d=b[e],c[d.id]={message:d.smart_title,lat:d.to_address.latitude,lng:d.to_address.longitude,autoPan:!1};return angular.extend(a,{markers:c})}},!0),a.$on("leafletDirectiveMarker.click",function(b,c){var d;return d=parseInt(c.markerName),a.focusOnEntry(_.find(a.results,function(a){return a.id===d}))})}])}.call(this),function(){"use strict";angular.module("seminaire2014App").controller("AboutCtrl",["$scope",function(){}])}.call(this),function(){"use strict";angular.module("seminaire2014App").controller("OverviewCtrl",["$scope","Services","leafletData","$timeout",function(a,b,c,d){return angular.extend(a,{tiles:{url:"https://stamen-tiles-{s}.a.ssl.fastly.net/watercolor/{z}/{x}/{y}.png"},markers:{}}),b.query(function(b){var e,f,g,h;for(a.services=b,e={},g=0,h=b.length;h>g;g++)f=b[g],2===parseInt(f.status)&&(e[f.city.replace(/-/g,"")]={message:f.city,lat:f.address.latitude,lng:f.address.longitude});return angular.extend(a,{markers:e}),d(function(){return c.getMap().then(function(a){return c.getMarkers().then(function(b){var c;return _.size(b)>0?(c=new L.featureGroup(_.values(b)),a.fitBounds(c)):void 0})})})})}])}.call(this),function(){"use strict";angular.module("seminaire2014App").controller("ContactCtrl",["$scope","$timeout","Message","notify",function(a,b,c,d){return a.loading=!1,a.answerToEntry=function(b){return a.loading=!0,c.save({receiver:b.creator,entry:b.id,body:a.answer},function(){return a.loading=!1,a.contact_form.show=!1,a.answer="",d({message:"Message envoyé à "+b.creator_nickname,classes:["alert-success"]})},function(a){return d({message:"Une erreur est survenue.",classes:["alert-danger"]}),console.error("error",a)})}}])}.call(this),function(){angular.module("seminaire2014App").config(["$stateProvider","$urlRouterProvider","$locationProvider","$httpProvider",function(a,b,c,d){return d.responseInterceptors.push("httpInterceptor"),b.otherwise("search"),a.state("search",{url:"/search",templateUrl:"scripts/views/search.html",controller:"SearchCtrl"}).state("entry",{url:"/entry/:id",templateUrl:"scripts/views/entry.html",controller:"SearchCtrl"}).state("overview",{url:"/overview",templateUrl:"scripts/views/overview.html",controller:"OverviewCtrl"}).state("about",{url:"/about",templateUrl:"scripts/views/about.html",controller:"AboutCtrl"}).state("login",{url:"/login",templateUrl:"scripts/views/login.html",controller:"LoginCtrl"})}])}.call(this),function(){angular.module("seminaire2014App.directives",[]).directive("scrollIf",function(){return{restrict:"A",scope:{scrollIf:"=scrollIf"},link:function(a,b){return a.$watch("scrollIf",function(){return a.scrollIf?$(".details").animate({scrollTop:b[0].offsetTop-100},"slow"):void 0})}}}).directive("addClassWhenOverViewport",["$window",function(a){return{restrict:"A",link:function(b,c,d){var e,f;return f=angular.element(a),e=c.offset().top+c.height(),f.on("scroll",function(){return f.scrollTop()>e?c.addClass(d.addClassWhenOverViewport):c.removeClass(d.addClassWhenOverViewport)})}}}]).directive("relayoutSearchView",["$window","leafletData","$timeout",function(a,b,c){return{restrict:"A",link:function(d,e){var f,g,h,i,j,k;return k=e.find(".results"),f=e.find(".details"),j=k.outerWidth(!0)+20,g=function(a,c){return b.getMap().then(function(d){return b.getMarkers().then(function(b){var e,g,h,i,k,l;return null!=c?(h=b[c.id],h.openPopup(),d.setView(h._latlng,15),e=d.latLngToContainerPoint(h._latlng),k=e.x+j/2,l=e.y+f.outerHeight(!0)/2,i=d.containerPointToLatLng([k,l]),d.setView(i,15)):(_.size(b)>0&&(g=new L.featureGroup(_.values(b)),d.fitBounds(g,{paddingBottomRight:[a[0],a[1]]})),d.closePopup())})})},h=function(a){return c(function(){return e.find(".details").hasClass("ng-hide")?g([j,0],a):g([j,f.outerHeight(!0)+20],a)})},i=function(a){return c(function(){var b,c,d;return d=$(window).height(),b=Math.min(d-300,f.find(".details__wrapper").outerHeight(!0)+40),c=d-b,f.css({width:$(window).width()-k.outerWidth(!0)-20,height:b,right:k.outerWidth(!0),top:c-45}),h(a)})},i(),angular.element(a).resize(function(){return i(d.entry_selected)}),d.$watch("contact_form.show",function(){return i(d.entry_selected)}),d.$watch("results",function(){return h()}),d.$watch("entry_selected",function(a){return i(a)})}}}])}.call(this);